<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ë” ì‘ì„±</title>

  <link rel="stylesheet" href="buttonStyles.css" />

  <style>
    body {
      font-size: 16px;
      font-family: Arial, sans-serif;
      padding: 20px;
      display: flex;
      gap: 30px;
      align-items: flex-start;
      /* ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ Yì¶• ë§ì¶¤ */
    }

    /* ---------------- ì¢Œì¸¡: ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨ ---------------- */
    #leftArea {
      width: 320px;
    }

    table {
      width: 200px;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th,
    td {
      border: 1px solid #999;
      padding: 6px;
      text-align: center;
    }

    th {
      background: #bae4ff;
    }

    /* ì„ ìˆ˜ ì¶”ê°€ ë“œë¡­ë‹¤ìš´ ì¶•ì†Œ */
    #playerSelect {
      width: 100px;
      padding: 4px;
    }

    /* ---------------- ìš°ì¸¡: ì•¼êµ¬ì¥ ì´ë¯¸ì§€ ì˜ì—­ ---------------- */
    #fieldArea {
      width: 500px;
      height: 400px;
      background-image: url("field.png");
      background-size: contain;
      background-repeat: no-repeat;
      position: relative;
      flex-shrink: 0;
      /* í™”ë©´ì´ ì¤„ì–´ë„ í¬ê¸° ìœ ì§€ */
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    /* í¬ì§€ì…˜ select ê³µí†µ (ì‘ê²Œ) */
    .posSelect {
      position: absolute;
      width: 70px;
      padding: 3px;
      font-size: 14px;
    }

    /* -------- í¬ì§€ì…˜ ìœ„ì¹˜ (ì„ì‹œê°’ â€” ë„ˆê°€ ì§ì ‘ ì¡°ì ˆí•˜ë©´ ë¨) -------- */

    /* ì™¸ì•¼ */
    #pos_CF {
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
    }

    #pos_LF {
      top: 25%;
      left: 18%;
    }

    #pos_RF {
      top: 25%;
      right: 18%;
    }

    /* ë‚´ì•¼ */
    #pos_2B {
      top: 47%;
      right: 30%;
    }

    #pos_SS {
      top: 47%;
      left: 30%;
    }

    #pos_1B {
      top: 63%;
      right: 20%;
    }

    #pos_3B {
      top: 63%;
      left: 20%;
    }


    /* ë°°í„°ë¦¬ */
    #pos_P {
      top: 63%;
      left: 50%;
      transform: translateX(-50%);
    }

    #pos_C {
      top: 80%;
      left: 50%;
      transform: translateX(-50%);
    }

    /* DH */
    #pos_DH {
      top: 85%;
      right: 13%;
    }
  </style>
</head>

<body>

  <!-- ----------------------------------------------------------- -->
  <!-- ì™¼ìª½ UI: ì°¸ê°€ ì„ ìˆ˜ / ì¶”ê°€ / ì‚­ì œ                           -->
  <!-- ----------------------------------------------------------- -->
  <div id="leftArea">

    <h1>ì˜¤ë” ì‘ì„±</h1>

    <div style="margin-bottom: 15px;">
      <label>ì˜¤ë”ëª…:</label>
      <input type="text" id="orderName" placeholder="ì˜ˆ: 4ì›” 28ì¼ NBL" style="width: 250px; padding: 6px;" />

      <button class="buttonStyles" onclick="saveOrder()">
        ğŸ’¾ ì €ì¥ (ì¶”í›„ êµ¬í˜„)
      </button>
    </div>

    <div style="display: flex; gap: 10px;">
      <div>
        <h3 style="margin-top: 20px;">ì°¸ê°€ ì„ ìˆ˜ ëª…ë‹¨</h3>

        <div style="display: flex; gap: 10px; align-items: center;">
          <select id="playerSelect"></select>
          <button class="buttonStyles" onclick="addPlayer()">ì¶”ê°€</button>
        </div>

        <table id="orderTable">
          <thead>
            <tr>
              <th>ì„ ìˆ˜ëª…</th>
              <th>ë°°ë²ˆ</th>
              <th>ì‚­ì œ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>



      <!-- ----------------------------------------------------------- -->
      <!-- ì˜¤ë¥¸ìª½ UI: ì´ë¯¸ì§€ ê¸°ë°˜ ì•¼êµ¬ì¥ + í¬ì§€ì…˜ select             -->
      <!-- ----------------------------------------------------------- -->
      <div id="fieldArea">

        <!-- ì™¸ì•¼ -->
        <select id="pos_CF" class="posSelect" onchange="updatePosition('CF', this.value)"></select>
        <select id="pos_LF" class="posSelect" onchange="updatePosition('LF', this.value)"></select>
        <select id="pos_RF" class="posSelect" onchange="updatePosition('RF', this.value)"></select>

        <!-- ë‚´ì•¼ -->
        <select id="pos_SS" class="posSelect" onchange="updatePosition('SS', this.value)"></select>
        <select id="pos_3B" class="posSelect" onchange="updatePosition('3B', this.value)"></select>
        <select id="pos_2B" class="posSelect" onchange="updatePosition('2B', this.value)"></select>

        <!-- ë°°í„°ë¦¬ -->
        <select id="pos_P" class="posSelect" onchange="updatePosition('P', this.value)"></select>
        <select id="pos_C" class="posSelect" onchange="updatePosition('C', this.value)"></select>

        <!-- DH -->
        <select id="pos_DH" class="posSelect" onchange="updatePosition('DH', this.value)"></select>

        <!-- 1ë£¨ìˆ˜ -->
        <select id="pos_1B" class="posSelect" onchange="updatePosition('1B', this.value)"></select>

      </div>
    </div>


  </div>






  <!-- ----------------------------------------------------------- -->
  <!-- ìŠ¤í¬ë¦½íŠ¸: ì„ ìˆ˜ DB, ì¶”ê°€/ì‚­ì œ, í¬ì§€ì…˜ ë°°ì¹˜                  -->
  <!-- ----------------------------------------------------------- -->
  <script>
    const API = {
      getPlayers: "https://getplayers-2guymqucma-uc.a.run.app"
    };

    let playerDB = [];
    let selectedPlayers = [];

    let positionAssignments = {
      CF: "", LF: "", RF: "",
      SS: "", "3B": "", "2B": "",
      P: "", C: "", DH: "", "1B": ""
    };

    window.onload = async () => {
      await loadPlayerDB();
      renderPlayerDropdown();
      renderOrderTable();
      renderPositionSelects();
    };

    async function loadPlayerDB() {
      const res = await fetch(API.getPlayers);
      playerDB = await res.json();
    }

    function renderPlayerDropdown() {
      const select = document.getElementById("playerSelect");
      select.innerHTML = "";

      const list = playerDB.filter(p => !selectedPlayers.includes(p.name));

      if (list.length === 0) {
        const opt = document.createElement("option");
        opt.textContent = "ì¶”ê°€í•  ì„ ìˆ˜ê°€ ì—†ìŒ";
        opt.disabled = true;
        select.appendChild(opt);
        return;
      }

      list.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.name;
        opt.textContent = `${p.name} (${p.num})`;
        select.appendChild(opt);
      });
    }

    function renderOrderTable() {
      const tbody = document.querySelector("#orderTable tbody");
      tbody.innerHTML = "";

      selectedPlayers.sort((a, b) => a.localeCompare(b, "ko"));

      selectedPlayers.forEach(name => {
        const p = playerDB.find(x => x.name === name);

        const tr = document.createElement("tr");
        tr.innerHTML = `
      <td>${p.name}</td>
      <td>${p.num}</td>
      <td>
        <button class="buttonStyles" onclick="removePlayer('${p.name}')">ì‚­ì œ</button>
      </td>
    `;
        tbody.appendChild(tr);
      });
    }

    function addPlayer() {
      const name = document.getElementById("playerSelect").value;
      if (!name) return;

      selectedPlayers.push(name);

      renderPlayerDropdown();
      renderOrderTable();
      renderPositionSelects();
    }

    function removePlayer(name) {
      selectedPlayers = selectedPlayers.filter(n => n !== name);

      for (const pos in positionAssignments) {
        if (positionAssignments[pos] === name) {
          positionAssignments[pos] = "";
        }
      }

      renderPlayerDropdown();
      renderOrderTable();
      renderPositionSelects();
    }

    function renderPositionSelects() {
      const selects = document.querySelectorAll(".posSelect");

      selects.forEach(sel => {
        const pos = sel.id.replace("pos_", "");
        sel.innerHTML = "";

        const blank = document.createElement("option");
        blank.value = "";
        blank.textContent = " ";
        sel.appendChild(blank);

        selectedPlayers.forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;

          if (positionAssignments[pos] === name) opt.selected = true;

          sel.appendChild(opt);
        });
      });
    }

    // í¬ì§€ì…˜ ì¤‘ë³µ ë°©ì§€ + ìë™ ì¬ë°°ì¹˜
    function updatePosition(pos, playerName) {
      for (const p in positionAssignments) {
        if (positionAssignments[p] === playerName) {
          positionAssignments[p] = "";
        }
      }

      positionAssignments[pos] = playerName;

      renderPositionSelects();
    }

    function saveOrder() {
      alert("ì €ì¥ì€ ì¶”í›„ êµ¬í˜„ë©ë‹ˆë‹¤!");
    }
  </script>

</body>

</html>